# **Lab 11: Kubernetes Secrets and Hashicorp Vault**

## **Task 1: Kubernetes Secrets and Resource Management**

### **1. Create a Secret Using `kubectl`**

#### Create Secret
```bash
> kubectl create secret generic lab-secret --from-literal=API_KEY=hello
secret/lab-secret created
```

#### Decode Secret
```bash
> kubectl get secret lab11-secret -o jsonpath='{.data}'
{"API_KEY":"aGVsbG8="}
```

### **2. Manage Secrets with Helm**

#### Upgrade Helm Deployment

```bash
> helm upgrade --install app-python . -f secrets.yaml
Release "python-app" has been upgraded. Happy Helming!
NAME: python-app
LAST DEPLOYED: Sun Mar  9 22:13:41 2025
NAMESPACE: default
STATUS: deployed
REVISION: 2
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=thon-app,app.kubernetes.io/instance=python-app" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath=.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
```

#### Verify Pod

```bash
> kubectl get po
NAME                          READY   STATUS    RESTARTS   AGE
python-app-867f578f57-vgwbv   1/1     Running   0          74s
```

#### Verify Secret in Pod

```bash
> kubectl exec python-app-867f578f57-vgwbv -- printenv | grep API_KEY
API_KEY=hello
```

## **Task 2: Vault Secret Management System**

### **1. Set Secret in Vault**

#### Enable KV Secrets Engine
```bash
>kubectl exec -it vault-0 -- vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
```

#### Add Secret to Vault
```bash
>kubectl exec -it vault-0 -- vault kv put internal/database/config username="sonyaiv"
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-03-09T20:13:42.963445522Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
```

#### Verify Secret in Vault
```bash
>kubectl exec -it vault-0 -- vault kv get internal/database/config
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-03-09T20:13:42.963445522Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
username    sonyaiv
```